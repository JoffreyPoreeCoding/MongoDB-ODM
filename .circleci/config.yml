version: 2.1

jobs:
    test:
        docker:
          - image: cimg/php:8.1
        # Add steps to the job
        # See: https://circleci.com/docs/2.0/configuration-reference/#steps
        steps:
            - checkout
            - run: pecl install xdebug 
            - restore_cache:
                keys:
                    - v1-dependencies-{{ checksum "composer.json" }}
                    - v1-dependencies-
            - run: composer install -n --prefer-dist --ignore-platform-reqs
            - save_cache:
                paths:
                    - ./vendor
                key: v1-dependencies-{{ checksum "composer.json" }}
            - run:  "./vendor/bin/phpunit"
            - run:
                name: Upload CodeCov.io Data
                command: bash <(curl -s https://codecov.io/bash) -F unittests
                when: always # Uploads code coverage results, pass or fail

# Invoke jobs via workflows
# See: https://circleci.com/docs/2.0/configuration-reference/#workflows
workflows:
    test:
        jobs:
            - test
